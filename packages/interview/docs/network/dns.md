# dns查询过程，dns用什么协议发起dns查询的

DNS（Domain Name System）是互联网上用于将域名转换为 IP 地址的系统。DNS 查询是通过 DNS 协议发起的。DNS 使用两种主要的协议：UDP（User Datagram Protocol）和TCP（Transmission Control Protocol）。

DNS 查询的过程如下：

1. **本地缓存查询**：首先，计算机会检查本地 DNS 缓存，查看是否已经解析过该域名。如果有缓存，将直接返回 IP 地址。

2. **递归查询**：如果本地缓存中没有相关记录，计算机会向本地 DNS 服务器发起 DNS 查询请求。本地 DNS 服务器通常由互联网服务提供商（ISP）提供。这个请求是一个递归查询，本地 DNS 服务器会负责向更高级别的 DNS 服务器发起查询，直到找到与域名对应的 IP 地址。

3. **迭代查询**：本地 DNS 服务器首先向根域名服务器发起查询请求。根域名服务器是 DNS 层次结构的最顶层，它不会直接返回域名与 IP 地址的映射，而是会告诉本地 DNS 服务器应该向哪个顶级域名服务器（如.com、.org）发起查询。

4. **顶级域名服务器查询**：本地 DNS 服务器接下来会向顶级域名服务器发起查询，询问要查询的域名的权威域名服务器是哪一个。例如，如果查询的是 example.com，本地 DNS 服务器会向.com 顶级域名服务器发起查询。

5. **权威域名服务器查询**：本地 DNS 服务器获得了权威域名服务器的信息后，会向权威域名服务器发起查询，请求解析域名的 IP 地址。

6. **IP 地址返回**：最终，权威域名服务器将与域名相关的 IP 地址返回给本地 DNS 服务器。

7. **结果返回**：本地 DNS 服务器将 IP 地址返回给计算机，同时缓存该映射以供将来使用。

在整个 DNS 查询过程中，大多数查询都使用 UDP 协议，这是因为 UDP 是一种无连接的协议，速度较快，适用于大多数 DNS 查询。只有在 DNS 数据包较大或查询失败时，才会使用 TCP 协议进行后备查询。

总之，DNS 查询过程是一个分层次的、递归和迭代的过程，它通过本地 DNS 服务器向更高级别的 DNS 服务器发起查询，直到找到域名与 IP 地址的映射关系。UDP 和 TCP 协议都可以用于 DNS 查询，但通常使用 UDP 进行快速查询。