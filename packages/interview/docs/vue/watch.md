# 解释一下 Vue 中的 watch

## 什么是watch

watch是一个选项，它用来监听数据的变化，当数据发生变化时，就会触发回调函数。

## 为什么要使用watch

当我们想要在数据变化时执行异步或开销较大的操作时，就可以使用watch。

## 实现原理

在 Vue.js 中，`watch` 的实现原理与计算属性(`computed`)有很大的相似性，都基于 Vue.js 的响应式系统。但在某些细节上，`watch` 的实现方式有所不同。接下来我会简要地介绍一下其实现原理。

首先，你需要知道的是 Vue.js 的响应式系统依赖于 ES5 的 `Object.defineProperty` API。Vue.js 通过这个 API 监听到数据的变化，然后在需要时重新渲染视图。

1. **依赖收集**

   当我们创建一个 Vue 实例时，Vue.js 会遍历 `data` 对象的所有属性，并用 `Object.defineProperty` 把这些属性转为 getter/setter。当我们访问这些属性时，getter 会被调用，并且把该属性添加到当前正在计算的 watcher 的依赖中。这样我们就知道了哪个 watcher 依赖了哪个属性。

2. **派发更新**

   当我们修改一个属性的值时，setter 会被调用，然后通知所有依赖这个属性的 watcher 更新。对于 `watch` 而言，这个更新操作就是执行它的回调函数。

3. **异步队列**

   Vue.js 内部对异步队列的处理，可以确保每次只进行一次更新，并且所有的 watcher 更新顺序是一致的。当一个 watcher 被通知更新时，它并不会立即执行更新操作，而是被推入到一个队列中，然后在下一个事件循环("tick")中，Vue.js 会清空并处理整个队列。

在源码层面，`watch` 的实现涉及到 `Watcher` 类和 `Dep` 类等。当你在 Vue 实例中定义了一个 `watch`，Vue.js 实际上会为其创建一个 `Watcher` 实例，然后通过依赖收集和派发更新的机制，实现 `watch` 的功能。

以上是 `watch` 的基础实现原理，要了解更详细的信息，你可以直接查看 Vue.js 的源码。