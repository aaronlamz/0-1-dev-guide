# 解释一下 defer 和 async 作用以及区别

`defer` 和 `async` 都是现代浏览器提供的两种加载外部脚本的方式，它们都旨在优化页面加载性能，但它们的工作方式有所不同。

### 1. 基础

传统的 `<script src="..."></script>` 标签会导致页面解析被阻塞，直到脚本完全下载和执行为止。对于大型脚本或者需要从远程服务器获取的脚本，这可能会导致明显的性能问题。`defer` 和 `async` 属性旨在解决这个问题。

### 2. defer

当脚本具有 `defer` 属性时：
- 脚本会并行下载，但不会立即执行。
- 脚本会按照它们在页面上的出现顺序进行执行。
- 所有的 `defer` 脚本都会在 DOMContentLoaded 事件之前，页面解析完成之后执行。

示例：
```html
<script src="script1.js" defer></script>
<script src="script2.js" defer></script>
```
无论哪个脚本先下载完成，`script1.js` 总是在 `script2.js` 之前执行。

### 3. async

当脚本具有 `async` 属性时：
- 脚本会并行下载。
- 一旦脚本下载完成，它将尽快执行，而不考虑它在页面上的位置。
- 它可能在文档还没有完全解析之前就执行，因此它可能在 DOMContentLoaded 事件之前或之后执行。

示例：
```html
<script src="script1.js" async></script>
<script src="script2.js" async></script>
```
这两个脚本谁先下载完成就先执行谁，所以执行顺序是不确定的。

### 4. 区别总结

- **执行时机**：`async` 脚本一旦下载完成就会立即执行，而 `defer` 脚本会等到整个页面都解析完毕后才执行。
- **执行顺序**：`defer` 脚本保证按照它们在 HTML 文档中的顺序执行，而 `async` 脚本的执行顺序是不可预测的。
  
### 5. 何时使用哪个？

- 如果你的脚本是模块化的，或者依赖于其他脚本，那么使用 `defer` 是明智的选择，因为它可以确保脚本按照正确的顺序执行。
- 如果你的脚本完全独立，与页面中的任何其他内容都没有关系，那么使用 `async` 可能是一个好选择，因为这可以确保脚本尽快执行。
  
需要注意的是，如果你在同一个 `<script>` 标签中同时使用了 `async` 和 `defer`，大多数浏览器只会考虑 `async`，但为了避免可能的混淆，最好不要同时使用两者。