# qiankun 工作原理

qiankun 是一个基于 single-spa 的微前端解决方案。它的工作原理和核心实现包含以下几个部分：

1. **基于 single-spa**：qiankun 基于 single-spa 实现，single-spa 是一个用于将前端应用组合在一起的 JavaScript 框架。它使得你可以在同一页面上使用多个前端框架（例如 React、Vue、Angular 等）并且它们可以独立开发、独立部署。

2. **应用隔离**：qiankun 通过 JS 沙箱和样式隔离来实现应用隔离。JS 沙箱主要是通过 Proxy 或快照等方式来隔离全局对象，防止微应用间全局对象的污染。样式隔离则是通过为 css 选择器添加特殊属性，只在当前微应用下生效，避免样式的冲突。

3. **微应用生命周期**：qiankun 提供了一套微应用的生命周期钩子，包括加载、挂载、更新、卸载等。开发者可以在这些钩子中做一些应用的初始化或者清理工作。

4. **主应用和微应用通信**：qiankun 提供了主应用和微应用间的通信机制，可以通过 props 的方式传递数据，也提供了全局状态管理的解决方案。

5. **预加载机制**：qiankun 提供了预加载机制，可以在微应用切换之前，提前加载微应用的资源，提高应用的响应速度。

6. **动态加载微应用**：qiankun 提供了动态加载微应用的功能，可以动态注册、卸载微应用，灵活管理微应用的资源。

7. **历史管理**：qiankun 对浏览器的 history 进行了改造，可以实现微应用间的路由隔离，保证微应用的独立性。

总的来说，qiankun 的核心实现就是在 single-spa 的基础上，增加了应用隔离、通信、预加载等功能，更加符合微前端的使用场景。